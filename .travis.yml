env:
  global:
  - secure: AnIYXG+P+dG/oO6v9+GPj7kXzqxrVQuytHOddjI6R1RGchXQcihN/R16ZaVMAdX7vpyJKtfQ1gyRnXL+s5+7U+2BoSHgWb1WJoxYr4LsTiZe3WfTlPehi+XR/eUJPawrkdDJROkM5pNoqQ7VZ8cJAFA59X08339kxJgxo4fqG+x+i3b7P/o8cTxHd+HoLaH6za5T15pZifOohTbACbMjSFHhL3C2769qfUNQyf4W4E3K46jV2VDTu4uyhRJcZxAGXDlWuVK3FFwOTbU6PWmY4DWAq85cLlr0zzvpNPNncUDdJ5/PElLrrjlyinrLzYdXhJK3IHxCYmGnZ8GPyeC4c0Z6Qc3OMDs6PaWIpPvql8+uu41J3PxHAe2c6SofsH0yrcf9rRPUm0+AXahAqvqApMyzxfHEGmjSywVJ0/BfHYN4mr5kUk/NS+HhcktzOJR6mwuZvUghmi3E7v35FQaVCU2N5wr4W/odMfKbxdEDO3er7qZ5PPAZxQwGEIQ4ZPr5XL7Vjhj83OI2e0HUrqlXmBB0lif9YRXvjeuJ3YMD5CnjtDQ0qhSxa2YHCJN9n4atKXeUoPZzjXWkgoYZJZY8Br/x9Pj/OGS79pbZWGS08zBCt0L9HeSJ3Tvu+0WNWNV2tCG55ONJtaZb1B/u03RQM2u406+a75116Rm7YJS677k=
  - secure: i7SPYR4e8TEFWF8MMGe1ocrXSXi9eznkDKPTJ4L+XCuOTommSHuq+gqFr1vQ/dMbbfeTSht0pviDgdXZ8TFQ0A1vR56mq98xzwsjyP8ktNSmmhENAnhEGg0i8PLE2I9gURGQA8mJULcI2kBtHOP8uLkWb+9Wz9/kR595uArO6R90Fj0v0QhPUjHqHN7lmBI71IeI4bUGkqfG7PhX6zj0m9bGfwQbU8XXar/G5fahu8a0WASTZXAxweBY9vKVxMy7RwzTSp8Ach9uK71EKr8LPoeQyJ9O8yVuEI8fqvcAu8AXF8hUhqGyxvqOTkhhT3GFwW+jA4mji/Ey8T0/0ANjVav7oomGoEquzHMl8iPzWzlP5ukMQs5CFVr7HAyGs1iW4Z+Mzj9WS6Br3K3T2+ejyebILIApxB/cySKJZLdsuKRziAnz2XUZkf26wyVPpBGIbtQvqFc9yhzLcrMG3j4Cwt049PYr2rT4d4D4LMpfpZr7xOOBp48Eb3mxGvaDOOdLS+vti8H+DOaZdcaCWudiS/bbZdpLxf+452GgDrczsc5ror3qH4KfmfTzsFvgBGtGkjydjppAvBm5ml6lMJFUkTP/PisbZS9cKd0P81S5CPWBiVeV+sM9eHpdNXmoXsqmgbLF2kXuslIKeW65AFS23/4sRTfigR0mIFIv5tt8bWc=

services:
- docker

addons:
  sonarcloud:
    organization: departement-loire-atlantique
    token:
      secure: M+8vAHlAT0EB4byV3wLQcWKiZF/JmolYEd7GDydRwAXBqWZsCNmWh80C0Nr2o4OhQpHrvSe3MROD4ZAH8gYAaWYZwaFm00NLLrjW1yb3rx0ExgeuSS5tzmjujSf61hbQaKw+3u2nDZMWaANfti4a5Cur9tFEcLXt2SAhNWV9jWxXb2cHrNdcT22qKigXrzJBWeAwvcKqCcKKGPoMfiMVcMqTb7caMRImIpleniRFQ/kjhOVrE10Qj/IyHgR34a8IBLBGvjJVNkCmYNMJ4IIOXjZl4QxJo68PvkXqToD7+bSZRp2GD1yaOFY4yr+Qu9L8ZlPgJ5D2VuPfYgUAGkBLt+p5SOP34a40H3OHTjxBaA4xCF3oswdO9w0zriNjgw+Fxn3XjGYWwpcrP69uZPDpgBAY9xTzFeZQA15HCqqKObe352FbXcYg4vuqKbGIcnUVobPXBicjGhgWzQMI/LWHb5aDRyOaUJL3UfPv0yKr55Re2VvqLg4zc52oNu6kuPT+dEWig9i5GEhQjTbLdMdZfGGk+++95PS9c39hp19cBYcjbcM6PdGYHWf/lKfi9qk7JZTXYoaso0eiS2Nm2gnYD9boPODSBlhWV+gQC0HyJjNKJ/79wYLqYRqXddHVqJiF5NdbuYZsH18Wilu1ssMshuMncTZ5c140GWHpsplKtYA=

before_script:
- echo "$DOCKER_PASS" | docker login --username $DOCKER_USER --password-stdin
- docker pull julienbayle/jplatformbuild

script:
- docker run -v ${TRAVIS_BUILD_DIR}:/root/source --name buildimage -t julienbayle/jplatformbuild
- docker cp buildimage:/root/dist .
- export CODE_VERSION=`git describe`
- sonar-scanner -Dsonar.projectVersion=$CODE_VERSION

deploy:
  provider: releases
  api_key:
    secure: Ct5zrGSgvMRPrif11NWtkWwVwAAeG58Ap4WGF/Sp9PSLF9Qr68WZADDNLE+2YNEYueKYdLhTPtYydZN7BeexgDMmYYOEAGBifqTWZVm3HYrfKCxysJjXtxztSOq5mkBXacG7e4B6TEGjPotQWEvtt/HfvXMgeDGUC27svI3OW4nc+7qoPKFUMV2a9dPZxO513YJe60uRsK1iyI6HEp8lajmZHe5L6514ZBrwnhMji3biebuezOT9bQnoWNFHI0KjHS1oaugo5/4eJqb83Lc+P6G9wPUgHAG2yCtor90rRJDGaNnNcg7OIGsLpTgIDaTakpGjfvd2xbTGrQEYhCi77BDB2/2efea7Ol5JnE2KzZPXdaz3vaZb5Y46CGs22msN9WXz/Owd04Zb7mTl+NJub+snL7SZQXQbRwqExjiWUkou3Do5YHqbSTIBxnlfP80NXkz7GYdvsYhUwNBSWMWnqdrz5VRfZFeXXGCkOSCqELZ3bQTpNrdsuXHG2w+hpJQUxL3V+YN1it0VbeLlABjfT5LcCertk4SdqlhU4KD1ib5gMqdfDepOwRATsHPTcVV9QaRLC+/aIZvT9/ZKIz+jOnsi9QH6hSRBS5K0utQXHX9PP+I0ot2Kfe0tHP3/tePsT3Kt8WEia0DG0tLu1k6JxcJ+4Dz1nuV7QqtnvGu0cHQ=
  file_glob: true
  file: "${TRAVIS_BUILD_DIR}/dist/*.zip"
  skip_cleanup: true
  on:
    tags: true
