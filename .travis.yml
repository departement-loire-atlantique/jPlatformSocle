env:
  global:
  - secure: GRw+LbVCeLpzkPZPzP8aznWH28qBG0HhW4rGbCG5PWWpmJS+9If3E5EoYevjjSGhwWYxr/wCoGiDY2EiKKAxKhAgmB6zhC8wumN4mIC1uCVW3zg3qSDOb7vcw+cnrMIlQT2jKcdzYpEOQq24xH/EqlBgVGr6W79xndgP/fC/S1H0zft65DnFLj1wbnuf5MhpXWLfs0sK7x3DKzYu1GzI0bqC9qMIX1f8XdNzv8K+vpCGwjkSuiV/HwuIVHKiDsAvnDY9JkAX9hs9Rw9cvRI9NVg4DMOm/BgYhJ7jNo5zN1yN8SgmgNTz9zf49TK0xnHJsSS59lxypHct/C8LZH69MlUw+/b3Iha39NKmngy52Tb34xR9Imok3QkaJS+SeNTXdzOaOeHfIPQbdzf4joCD/1XNWACuaKDrM/doAKcFzfEBd0oRfm4LV5utlnzeeqK+r008kgjnkpmQ6PkXtgZ8IPTKDXjFlx92lCLpQB+FsFVDyMZF6C4Wh2Up/a+533FtR44yELq1rTLbYYMV0lBZkmmZkZC0UNO2rx2fPjN7s07WcqgJ9stKnFVX2w03lADivMGtCaptQsk4H6mMI+cwHd5lYdvzSn3Fn8nL+fXKTGnWAHyqgCyvIvNG+j0LL6O1mpbcyZuAvsCR7iDqQOm4Jh6LsUAN1rnFzKcldrhxdYc=
  - secure: OWYHp8jjwSlalBsM6mKIe34XGkn6s+9jdinfD3w3Regn5DrjwUSdOSwJvnAPkYZXdPU1RQtYZ6HFpCQnu7ndh2/eFRbq/J1Rs1TKpec96iwJjLAD51iSUWaVrsKSEZDYCXo6PjGUPw3NTKRRRl9A+xYEO9VUgzKboV6NYAh4xKdbnlmY4eTsadyN3qATpBUbz6VRWETRjOBP95m5MwyBxoYhBMjdxLYoracvbBEUYml6dWYKupIiCXoiriUovxqOLgxj1qb+vaF1t1fk1w2DXFhFHxrn922o1Pe/qYZzKqx/1nDxEMIkuOIJQAN/UlSdVZh0LoBnAUK+QSx0tmE50MBF3OUtD92J67/GrYbh/FlPQVxaHm0RN0trLplZDNBZ/DEjtsvi+rwJROG1E61RyeL9jTcn56Bwsl5kCWFCFCHHhOVr1XwzIDzTNwn1kexQd7hw2T+IXWwWWo7SpJWrdU3x2m/EmJsaQWRsrGcWy2wSod4kUikvstcAR75l8xCBIGzfFKZUqcuWZShmdsh/G3JS793EYDkq5K7Su7uP5OymXRqQAoOqmHYJNuVB4lpgMUlZYo8atGXe1TVnIfRiBArQ9GAXOZsXehAjyIhWkXEJqKWXgZuU4+X59D0vysSZ/HrA6aeN7EVunxncrzGW7xUdR5eQBYPil2AP2y+9Tuk=

services:
- docker

addons:
  sonarcloud:
    organization: departement-loire-atlantiqu-1
    token:
      secure: Udq+ykA5sG8Gah/rNX63ybHHMCA+65Bg6Hhq7oBxaTE4C15RsWSBRNgyhmp9YS75FRKp1WdjLuLSg6WUMqPVp66sOQWScN6jdm4lz+VZ0eDEQiqwpTvfAU3kkRgYB4/9qBPx5YaeRduAo21yx7RE4taH9wM5zuEa6YJnQM24BPbs/kSfLqQ5jhaGjuXJvu8stmUNQlcPRYF6u7qbHS1v+k3tMwLwIuIG6GqlpcKUaK42PgHdV0IEl2NN43i0VKXtasFFGo7x5NbZI6wGQ9YGuIoiW4sRfwU0rNWBP4gvG8LU/fVu3nw87mc01pfu5KkiN21kWqYAAdBGTSwsr7J8CGtd16u6VWBFJ/lAwRmwafZzdRB1StHJBAEAxOzwb6TU3/AQKIaRVjm5UlUyaO2q/sVQeImpkFU3BCKLyGsnZlgMR2xJIMkKui6CtM8oUz/N6uotpBVwOl9hA+FKXblvkMz2nes3tSiWlO0UbTX8c2saE8rSjhBPwfqIVAf9UitIcOG4nI5epnTJlPJ77U7E1LoEHKdKhNr2Vm6yT+O1c4BEKwso/359+9GArry0rhQSD/411tOOwXG70Iu2jaxgBCCumqUgnsdfav5RUOqsqXOvpZqzP79eDRIIMhTc2DLKxDtbOcbxykZKGOSD4rVapVYsZgeME0S3vpwA2z8g42M=

before_script:
- echo "$DOCKER_PASS" | docker login --username $DOCKER_USER --password-stdin
- docker pull asfram/jplatformbuild:1.1

script:
- docker run -v ${TRAVIS_BUILD_DIR}:/root/source --name buildimage -t asfram/jplatformbuild:1.1
- docker cp buildimage:/root/dist .
- export CODE_VERSION=`git describe`
- sonar-scanner -Dsonar.projectVersion=$CODE_VERSION

deploy:
  provider: releases
  api_key:
    secure: ByT6zMWetpaFT2vuGCuchPf++rUEPmR4TIG34wUCkwMRJAmW2uoy5ckKkXNjgra4aaPUjtM6ISQnG8GeOshwBQQgehzdSIThAi0J7DltemArKa+Kz1EOZGpMC497KUgTYbmmpgqXjSFWg4D+09pfPA7kH4iCiT9ysoUeqvLAOHdZwE5EGb4EiEh8IxZsXuWevVFiOiHm2PMA1psXRRdfzl1NG5DJfRf7fCLVzyboTuN7afzWLjRDGCew/Ypv9Yyff591GxPL/lv2aP7KpdYa3c6utWxEDrTBLF5IdCCVEWYNH5iV83Tl+CPOYmL6StHj2DLtoFhwpOh6udTuTPu285KXHpuUN/gpMnqyR62bcNsgrMQcg2tTJuUE8WbsLIyvn5aDPiBW7IFB4AVBQ1mSkG79AQT+FEDxzCiaeQpv7P6qnZ0x9djTkKJCxsv/stP+fdnrqdkDIGzIXY0C1H6ND1CpxQAhquwdyhhHWLvS7Dw7J26Jd55WkLF6feWJG03HzRiv2DwsyU/zoRZQN+2E7x0TYfgOB0u/hAuLJ1Agr0o2Vnqjfl15Xq2WpBg0ZoeggsArTEjwdHUFl28ZRK0rmYX9Z7++0s3LfVR0I+lX2EWwI1obZeVq2iyuCwBHq3g221QszyUXEWSnzif2+fIU/wXm+1je0IaVfETlOSTTQWc=
  file_glob: true
  file: "${TRAVIS_BUILD_DIR}/dist/*.zip"
  skip_cleanup: true
  on:
    tags: true
